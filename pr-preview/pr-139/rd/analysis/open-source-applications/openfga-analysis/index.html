<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/battlebots/pr-preview/pr-139/favicons/favicon.ico><link rel=apple-touch-icon href=/battlebots/pr-preview/pr-139/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/battlebots/pr-preview/pr-139/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/battlebots/pr-preview/pr-139/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/battlebots/pr-preview/pr-139/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/battlebots/pr-preview/pr-139/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/battlebots/pr-preview/pr-139/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/battlebots/pr-preview/pr-139/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/battlebots/pr-preview/pr-139/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/battlebots/pr-preview/pr-139/favicons/android-192x192.png sizes=192x192><title>OpenFGA Analysis | Battle Bots Documentation</title><meta name=description content="Comprehensive analysis of OpenFGA fine-grained authorization system, including JWT integration, deployment options, policy definition, and dynamic data capabilities."><meta property="og:url" content="https://z5labs.github.io/battlebots/pr-preview/pr-139/rd/analysis/open-source-applications/openfga-analysis/"><meta property="og:site_name" content="Battle Bots Documentation"><meta property="og:title" content="OpenFGA Analysis"><meta property="og:description" content="Comprehensive analysis of OpenFGA fine-grained authorization system, including JWT integration, deployment options, policy definition, and dynamic data capabilities."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="r&amp;d"><meta property="article:published_time" content="2025-11-02T00:00:00+00:00"><meta property="article:modified_time" content="2025-11-02T00:00:00+00:00"><meta itemprop=name content="OpenFGA Analysis"><meta itemprop=description content="Comprehensive analysis of OpenFGA fine-grained authorization system, including JWT integration, deployment options, policy definition, and dynamic data capabilities."><meta itemprop=datePublished content="2025-11-02T00:00:00+00:00"><meta itemprop=dateModified content="2025-11-02T00:00:00+00:00"><meta itemprop=wordCount content="5437"><meta name=twitter:card content="summary"><meta name=twitter:title content="OpenFGA Analysis"><meta name=twitter:description content="Comprehensive analysis of OpenFGA fine-grained authorization system, including JWT integration, deployment options, policy definition, and dynamic data capabilities."><link rel=preload href=/battlebots/pr-preview/pr-139/scss/main.min.74eef40c5172b0e2f11bd9c3ea40dba66c2dc642ac5294c208f5dc9ff772c0e9.css as=style integrity="sha256-dO70DFFysOLxG9nD6kDbpmwtxkKsUpTCCPXcn/dywOk=" crossorigin=anonymous><link href=/battlebots/pr-preview/pr-139/scss/main.min.74eef40c5172b0e2f11bd9c3ea40dba66c2dc642ac5294c208f5dc9ff772c0e9.css rel=stylesheet integrity="sha256-dO70DFFysOLxG9nD6kDbpmwtxkKsUpTCCPXcn/dywOk=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-page><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/battlebots/pr-preview/pr-139/><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class=navbar-brand__name>Battle Bots Documentation</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/battlebots/pr-preview/pr-139/offline-search-index.e81ec1f6b1c2c5d7ef0fe710de9dd541.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/battlebots/pr-preview/pr-139/offline-search-index.e81ec1f6b1c2c5d7ef0fe710de9dd541.json data-offline-search-base-href=/ data-offline-search-max-results=10></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-battlebotspr-previewpr-139-li><a href=/battlebots/pr-preview/pr-139/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-battlebotspr-previewpr-139><span>Battle Bots</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-battlebotspr-previewpr-139rd-li><a href=/battlebots/pr-preview/pr-139/rd/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-battlebotspr-previewpr-139rd><span>Research & Design</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-battlebotspr-previewpr-139rduser-journeys-li><a href=/battlebots/pr-preview/pr-139/rd/user-journeys/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-battlebotspr-previewpr-139rduser-journeys><span>User Journeys</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-battlebotspr-previewpr-139rduser-journeys0001-user-registration-li><a href=/battlebots/pr-preview/pr-139/rd/user-journeys/0001-user-registration/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-battlebotspr-previewpr-139rduser-journeys0001-user-registration><span>[0001] User Registration</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-battlebotspr-previewpr-139rdadrs-li><a href=/battlebots/pr-preview/pr-139/rd/adrs/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-battlebotspr-previewpr-139rdadrs><span>Architecture Decision Records</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-battlebotspr-previewpr-139rdadrs0001-use-madr-for-architecture-decision-records-li><a href=/battlebots/pr-preview/pr-139/rd/adrs/0001-use-madr-for-architecture-decision-records/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-battlebotspr-previewpr-139rdadrs0001-use-madr-for-architecture-decision-records><span>[0001] Use MADR for Architecture Decision Records</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-battlebotspr-previewpr-139rdadrs0002-user-registration-via-github-oauth-li><a href=/battlebots/pr-preview/pr-139/rd/adrs/0002-user-registration-via-github-oauth/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-battlebotspr-previewpr-139rdadrs0002-user-registration-via-github-oauth><span>[0002] User Registration via GitHub OAuth</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-battlebotspr-previewpr-139rdadrs0003-stateless-jwt-authentication-li><a href=/battlebots/pr-preview/pr-139/rd/adrs/0003-stateless-jwt-authentication/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-battlebotspr-previewpr-139rdadrs0003-stateless-jwt-authentication><span>[0003] Stateless Authentication via JWT Tokens</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-battlebotspr-previewpr-139rdanalysis-li><a href=/battlebots/pr-preview/pr-139/rd/analysis/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-battlebotspr-previewpr-139rdanalysis><span>Analysis</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-battlebotspr-previewpr-139rdanalysisopen-source-applications-li><a href=/battlebots/pr-preview/pr-139/rd/analysis/open-source-applications/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-battlebotspr-previewpr-139rdanalysisopen-source-applications><span>Open Source Applications</span></a><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-battlebotspr-previewpr-139rdanalysisopen-source-applicationsopenfga-analysis-li><a href=/battlebots/pr-preview/pr-139/rd/analysis/open-source-applications/openfga-analysis/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-battlebotspr-previewpr-139rdanalysisopen-source-applicationsopenfga-analysis><span class=td-sidebar-nav-active-item>OpenFGA Analysis</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-battlebotspr-previewpr-139rdanalysissecurity-li><a href=/battlebots/pr-preview/pr-139/rd/analysis/security/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-battlebotspr-previewpr-139rdanalysissecurity><span>Security</span></a><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-battlebotspr-previewpr-139rdanalysissecurityauth0-login-pages-analysis-li><a href=/battlebots/pr-preview/pr-139/rd/analysis/security/auth0-login-pages-analysis/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-battlebotspr-previewpr-139rdanalysissecurityauth0-login-pages-analysis><span>Auth0 Login Pages Analysis</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-battlebotspr-previewpr-139rdanalysissecuritykeycloak-login-pages-analysis-li><a href=/battlebots/pr-preview/pr-139/rd/analysis/security/keycloak-login-pages-analysis/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-battlebotspr-previewpr-139rdanalysissecuritykeycloak-login-pages-analysis><span>Keycloak Login Pages Analysis</span></a></li></ul></li></ul></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"><a href=https://github.com/z5labs/battlebots/tree/main/content/r&amp;d/analysis/open-source-applications/openfga-analysis.md class="td-page-meta--view td-page-meta__view" target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href=https://github.com/z5labs/battlebots/edit/main/content/r&amp;d/analysis/open-source-applications/openfga-analysis.md class="td-page-meta--edit td-page-meta__edit" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
<a href="https://github.com/z5labs/battlebots/new/main/content/r&amp;d/analysis/open-source-applications?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class="td-page-meta--child td-page-meta__child" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
<a href="https://github.com/z5labs/battlebots/issues/new?title=OpenFGA%20Analysis" class="td-page-meta--issue td-page-meta__issue" target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/z5labs/battlebots/issues/new class="td-page-meta--project td-page-meta__project-issue" target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create project issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#executive-summary>Executive Summary</a></li><li><a href=#overview-of-openfga>Overview of OpenFGA</a><ul><li><a href=#what-is-openfga>What is OpenFGA?</a></li><li><a href=#key-concepts>Key Concepts</a></li><li><a href=#rebac-vs-rbac>ReBAC vs. RBAC</a></li></ul></li><li><a href=#jwt-verification-and-integration>JWT Verification and Integration</a><ul><li><a href=#separation-of-authentication-and-authorization>Separation of Authentication and Authorization</a></li><li><a href=#integration-pattern>Integration Pattern</a></li><li><a href=#framework-specific-implementations>Framework-Specific Implementations</a></li><li><a href=#jwt-claims-as-contextual-data>JWT Claims as Contextual Data</a></li><li><a href=#oidc-support>OIDC Support</a></li><li><a href=#best-practices-for-jwt--openfga-integration>Best Practices for JWT + OpenFGA Integration</a></li></ul></li><li><a href=#deployment-options>Deployment Options</a><ul><li><a href=#docker-deployment>Docker Deployment</a></li><li><a href=#kubernetes-deployment>Kubernetes Deployment</a></li><li><a href=#binary-deployment>Binary Deployment</a></li><li><a href=#storage-backend-options>Storage Backend Options</a></li><li><a href=#configuration-options>Configuration Options</a></li><li><a href=#security-configuration>Security Configuration</a></li><li><a href=#monitoring-and-profiling>Monitoring and Profiling</a></li></ul></li><li><a href=#policy-definition>Policy Definition</a><ul><li><a href=#configuration-language-overview>Configuration Language Overview</a></li><li><a href=#converting-between-formats>Converting Between Formats</a></li><li><a href=#dsl-syntax>DSL Syntax</a></li><li><a href=#relationship-definitions>Relationship Definitions</a></li><li><a href=#complex-authorization-models>Complex Authorization Models</a></li><li><a href=#json-format-example>JSON Format Example</a></li><li><a href=#testing-authorization-models>Testing Authorization Models</a></li><li><a href=#modeling-best-practices>Modeling Best Practices</a></li><li><a href=#tools-for-modeling>Tools for Modeling</a></li></ul></li><li><a href=#dynamic-data-and-contextual-tuples>Dynamic Data and Contextual Tuples</a><ul><li><a href=#what-are-contextual-tuples>What are Contextual Tuples?</a></li><li><a href=#how-contextual-tuples-work>How Contextual Tuples Work</a></li><li><a href=#use-cases>Use Cases</a></li><li><a href=#contextual-tuples-api-examples>Contextual Tuples API Examples</a></li><li><a href=#limitations-and-considerations>Limitations and Considerations</a></li><li><a href=#best-practices>Best Practices</a></li></ul></li><li><a href=#integration-patterns-for-battle-bots>Integration Patterns for Battle Bots</a><ul><li><a href=#recommended-architecture>Recommended Architecture</a></li><li><a href=#example-bot-deployment-authorization>Example: Bot Deployment Authorization</a></li><li><a href=#relationship-management>Relationship Management</a></li></ul></li><li><a href=#pros-and-cons-for-battle-bots>Pros and Cons for Battle Bots</a><ul><li><a href=#pros-of-using-openfga>Pros of Using OpenFGA</a></li><li><a href=#cons-of-using-openfga>Cons of Using OpenFGA</a></li></ul></li><li><a href=#recommendations-for-battle-bots>Recommendations for Battle Bots</a><ul><li><a href=#recommendation-1-adopt-openfga-for-authorization>Recommendation 1: Adopt OpenFGA for Authorization</a></li><li><a href=#recommendation-2-start-simple-iterate>Recommendation 2: Start Simple, Iterate</a></li><li><a href=#recommendation-3-design-authorization-model-carefully>Recommendation 3: Design Authorization Model Carefully</a></li><li><a href=#recommendation-4-implement-caching>Recommendation 4: Implement Caching</a></li><li><a href=#recommendation-5-monitor-openfga-performance>Recommendation 5: Monitor OpenFGA Performance</a></li><li><a href=#recommendation-6-plan-for-model-evolution>Recommendation 6: Plan for Model Evolution</a></li></ul></li><li><a href=#alternative-considerations>Alternative Considerations</a><ul><li><a href=#alternative-1-ory-keto>Alternative 1: Ory Keto</a></li><li><a href=#alternative-2-spicedb>Alternative 2: SpiceDB</a></li><li><a href=#alternative-3-custom-authorization-service>Alternative 3: Custom Authorization Service</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li><li><a href=#references>References</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/battlebots/pr-preview/pr-139/rd/>Research & Design</a></li><li class=breadcrumb-item><a href=/battlebots/pr-preview/pr-139/rd/analysis/>Analysis</a></li><li class=breadcrumb-item><a href=/battlebots/pr-preview/pr-139/rd/analysis/open-source-applications/>Open Source Applications</a></li><li class="breadcrumb-item active" aria-current=page>OpenFGA Analysis</li></ol></nav><div class=td-content><h1>OpenFGA Analysis</h1><div class=lead>Comprehensive analysis of OpenFGA fine-grained authorization system, including JWT integration, deployment options, policy definition, and dynamic data capabilities.</div><header class=article-meta></header><h2 id=executive-summary>Executive Summary</h2><p>This document analyzes OpenFGA (Open Fine-Grained Authorization), a high-performance authorization system inspired by Google Zanzibar, to determine its suitability for implementing fine-grained access control in the Battle Bots platform. OpenFGA provides Relationship-Based Access Control (ReBAC) that answers authorization questions like &ldquo;Does user U have relation R with object O?&rdquo; rather than traditional role-based approaches.</p><p><strong>Key Finding:</strong> OpenFGA is a mature, production-ready authorization system that separates authentication from authorization, allowing it to work seamlessly with JWT-based authentication systems. It offers flexible deployment options (Docker, Kubernetes, binary), uses an intuitive DSL for policy definition, and supports dynamic authorization decisions through contextual tuples. For Battle Bots&rsquo; planned GitHub OAuth authentication strategy, OpenFGA provides a robust path to implementing fine-grained permissions for bot management, organization access, and game resources.</p><h2 id=overview-of-openfga>Overview of OpenFGA</h2><h3 id=what-is-openfga>What is OpenFGA?</h3><p>OpenFGA is a high-performance, flexible authorization/permission engine built for developers and inspired by Google&rsquo;s Zanzibar paper. It implements Relationship-Based Access Control (ReBAC), which models permissions as relationships between users and resources.</p><p><strong>Core Characteristics:</strong></p><ul><li>Open source (Apache 2.0 license)</li><li>Inspired by Google Zanzibar (used by Google Drive, Calendar, Photos, etc.)</li><li>Focuses exclusively on authorization (not authentication)</li><li>Designed for fine-grained permissions at scale</li><li>Supports both direct relationships and computed permissions</li><li>Provides APIs for authorization checks, relationship management, and model queries</li></ul><h3 id=key-concepts>Key Concepts</h3><p><strong>Authorization Model:</strong> Defines the types of objects in your system and how they relate to each other (e.g., users can be viewers, editors, or owners of documents).</p><p><strong>Relationship Tuples:</strong> Store the actual relationships between users and objects (e.g., &ldquo;anne is owner of document:1&rdquo;).</p><p><strong>Check API:</strong> Evaluates whether a user has a specific relation/permission on an object based on the model and stored tuples.</p><p><strong>Contextual Tuples:</strong> Temporary relationships provided at query time that exist only for that specific authorization check.</p><h3 id=rebac-vs-rbac>ReBAC vs. RBAC</h3><table><thead><tr><th>Aspect</th><th>Traditional RBAC</th><th>OpenFGA ReBAC</th></tr></thead><tbody><tr><td><strong>Permission Model</strong></td><td>Users assigned to roles; roles have permissions</td><td>Users have relationships with specific objects</td></tr><tr><td><strong>Granularity</strong></td><td>Coarse-grained (role-level)</td><td>Fine-grained (object-level)</td></tr><tr><td><strong>Hierarchy</strong></td><td>Simple role hierarchies</td><td>Complex relationship graphs with inheritance</td></tr><tr><td><strong>Question Answered</strong></td><td>&ldquo;Does user have role X?&rdquo;</td><td>&ldquo;Does user have relation R with object O?&rdquo;</td></tr><tr><td><strong>Examples</strong></td><td>&ldquo;Is user an admin?&rdquo;</td><td>&ldquo;Can user edit document:123?&rdquo;</td></tr><tr><td><strong>Scalability</strong></td><td>Limited for complex scenarios</td><td>Designed for millions of relationships</td></tr></tbody></table><h2 id=jwt-verification-and-integration>JWT Verification and Integration</h2><h3 id=separation-of-authentication-and-authorization>Separation of Authentication and Authorization</h3><p>OpenFGA focuses exclusively on authorization, making it designed to work alongside authentication systems like JWT verification rather than replacing them. The typical integration pattern separates concerns:</p><p><strong>Authentication (AuthN):</strong> Verifies user identity through JWT token validation
<strong>Authorization (AuthZ):</strong> Determines what the authenticated user can do via OpenFGA</p><h3 id=integration-pattern>Integration Pattern</h3><p>The standard integration flow for JWT + OpenFGA:</p><pre tabindex=0><code>1. Request arrives with JWT Bearer token
   ↓
2. Middleware validates JWT signature
   ↓
3. Middleware extracts user identity from JWT claims
   ↓
4. Application calls OpenFGA Check API
   - User: extracted from JWT (e.g., &#34;user:anne&#34;)
   - Relation: mapped from operation (e.g., &#34;can_edit&#34;)
   - Object: target resource (e.g., &#34;document:123&#34;)
   ↓
5. OpenFGA evaluates authorization
   ↓
6. Application allows or denies request
</code></pre><h3 id=framework-specific-implementations>Framework-Specific Implementations</h3><h4 id=nodejs--fastify-example>Node.js / Fastify Example</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Step 1: JWT Authentication
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>app</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>decorate</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;authenticate&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>async</span> <span style=color:#204a87;font-weight:700>function</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>request</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>reply</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>try</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>await</span> <span style=color:#000>request</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>jwtVerify</span><span style=color:#000;font-weight:700>();</span> <span style=color:#8f5902;font-style:italic>// Validates JWT signature
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>catch</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>reply</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>send</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Step 2: Authorization Preparation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>app</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>decorate</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;preauthorize&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>async</span> <span style=color:#204a87;font-weight:700>function</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>request</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>reply</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>method</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>request</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>method</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>documentName</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>request</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>params</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>documentName</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Map HTTP method to OpenFGA relation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>relation</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>method</span> <span style=color:#ce5c00;font-weight:700>===</span> <span style=color:#4e9a06>&#39;GET&#39;</span> <span style=color:#ce5c00;font-weight:700>?</span> <span style=color:#4e9a06>&#39;reader&#39;</span> <span style=color:#ce5c00;font-weight:700>:</span>
</span></span><span style=display:flex><span>                   <span style=color:#000>method</span> <span style=color:#ce5c00;font-weight:700>===</span> <span style=color:#4e9a06>&#39;POST&#39;</span> <span style=color:#ce5c00;font-weight:700>?</span> <span style=color:#4e9a06>&#39;writer&#39;</span> <span style=color:#ce5c00;font-weight:700>:</span>
</span></span><span style=display:flex><span>                   <span style=color:#000>method</span> <span style=color:#ce5c00;font-weight:700>===</span> <span style=color:#4e9a06>&#39;DELETE&#39;</span> <span style=color:#ce5c00;font-weight:700>?</span> <span style=color:#4e9a06>&#39;owner&#39;</span> <span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Extract user from JWT claims
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>user</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>`user:</span><span style=color:#4e9a06>${</span><span style=color:#000>request</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>user</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>username</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>`</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Format resource
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>object</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>`document:</span><span style=color:#4e9a06>${</span><span style=color:#000>documentName</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>`</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>request</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>authParams</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>user</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>relation</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>object</span> <span style=color:#000;font-weight:700>};</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Step 3: OpenFGA Check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>app</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>addHook</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;preHandler&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>async</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>request</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>reply</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>=&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>user</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>relation</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>object</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>request</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>authParams</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>allowed</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>await</span> <span style=color:#000>fgaClient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>check</span><span style=color:#000;font-weight:700>({</span>
</span></span><span style=display:flex><span>    <span style=color:#000>user</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>relation</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>object</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>!</span><span style=color:#000>allowed</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>reply</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>code</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>403</span><span style=color:#000;font-weight:700>).</span><span style=color:#000>send</span><span style=color:#000;font-weight:700>({</span> <span style=color:#000>error</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;Forbidden&#39;</span> <span style=color:#000;font-weight:700>});</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>});</span>
</span></span></code></pre></div><h4 id=go--fiber-example>Go / Fiber Example</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// JWT Middleware (Authentication)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>app</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Use</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>jwtware</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>New</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>jwtware</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Config</span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>SigningKey</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[]</span><span style=color:#204a87>byte</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>os</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Getenv</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;JWT_SECRET&#34;</span><span style=color:#000;font-weight:700>)),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}))</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// Authorization Middleware</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>app</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Use</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>c</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>fiber</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Ctx</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>error</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>user</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>:=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Locals</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;user&#34;</span><span style=color:#000;font-weight:700>).(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>jwt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Token</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>claims</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>:=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>user</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Claims</span><span style=color:#000;font-weight:700>.(</span><span style=color:#000>jwt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MapClaims</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>username</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>:=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>claims</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;username&#34;</span><span style=color:#000;font-weight:700>].(</span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// Map method to relation</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>method</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>:=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Method</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>relation</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>:=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>methodToRelation</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>method</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// OpenFGA Check</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>body</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>err</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>:=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>fgaClient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Check</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Background</span><span style=color:#000;font-weight:700>()).</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>Body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ClientCheckRequest</span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000>User</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Sprintf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;user:%s&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>username</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000>Relation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>relation</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000>Object</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Sprintf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;document:%s&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Params</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#000;font-weight:700>)),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>}).</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>Execute</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>if</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>err</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>!=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>nil</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>||</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>!</span><span style=color:#000>body</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetAllowed</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Status</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>403</span><span style=color:#000;font-weight:700>).</span><span style=color:#000>JSON</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>fiber</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Map</span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#4e9a06>&#34;error&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;Forbidden&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Next</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=jwt-claims-as-contextual-data>JWT Claims as Contextual Data</h3><p>OpenFGA supports using JWT claims as contextual tuples for dynamic authorization. This pattern is useful for:</p><p><strong>Multi-Tenancy:</strong> JWT contains current organization context</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// JWT payload
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;sub&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;user:anne&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;current_org&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;org:acme&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// OpenFGA Check with contextual tuple
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>await</span> <span style=color:#000>fgaClient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>check</span><span style=color:#000;font-weight:700>({</span>
</span></span><span style=display:flex><span>  <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;user:anne&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>relation</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;can_manage_bots&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>object</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;bot:battle-bot-1&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>contextualTuples</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;user:anne&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000>relation</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;member&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000>object</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;org:acme&#34;</span>  <span style=color:#8f5902;font-style:italic>// From JWT claim
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>});</span>
</span></span></code></pre></div><p><strong>Time-Based Access:</strong> JWT contains role assignments with temporal context
<strong>IP-Based Restrictions:</strong> JWT contains location/IP information for access decisions</p><h3 id=oidc-support>OIDC Support</h3><p>OpenFGA supports OIDC authentication for its own API access (not to be confused with application-level authentication):</p><ul><li>Client credentials flow with client ID and secret</li><li>JWT tokens with <code>kid</code> header for key identification</li><li>Integration with identity providers (Auth0, Keycloak, etc.)</li><li>Audience and issuer validation</li></ul><p>This enables secure API access for administrative operations and service-to-service communication.</p><h3 id=best-practices-for-jwt--openfga-integration>Best Practices for JWT + OpenFGA Integration</h3><ol><li><strong>Always verify JWT first:</strong> Never call OpenFGA without valid authentication</li><li><strong>Extract user identity from JWT claims:</strong> Use standardized claims (<code>sub</code>, <code>username</code>, etc.)</li><li><strong>Map operations to relations:</strong> Create consistent mapping from HTTP methods/actions to OpenFGA relations</li><li><strong>Use contextual tuples sparingly:</strong> Prefer storing relationships in OpenFGA when they&rsquo;re stable</li><li><strong>Cache authorization decisions:</strong> Implement caching layer for frequently checked permissions</li><li><strong>Handle errors gracefully:</strong> Distinguish between authentication failures and authorization denials</li></ol><h2 id=deployment-options>Deployment Options</h2><p>OpenFGA provides multiple deployment options suitable for different environments and requirements.</p><h3 id=docker-deployment>Docker Deployment</h3><h4 id=quick-start-memory-storage>Quick Start (Memory Storage)</h4><p>The simplest deployment uses in-memory storage for development:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Pull the latest image</span>
</span></span><span style=display:flex><span>docker pull openfga/openfga
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Run with memory storage (development only)</span>
</span></span><span style=display:flex><span>docker run -p 8080:8080 -p 8081:8081 -p 3000:3000 openfga/openfga run
</span></span></code></pre></div><p><strong>Exposed Ports:</strong></p><ul><li><strong>8080:</strong> HTTP API</li><li><strong>8081:</strong> gRPC API</li><li><strong>3000:</strong> Playground UI (web-based testing interface)</li></ul><p><strong>Warning:</strong> Memory storage loses all data on restart. Not suitable for production.</p><h4 id=production-with-postgresql>Production with PostgreSQL</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Create Docker network</span>
</span></span><span style=display:flex><span>docker network create openfga
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Run PostgreSQL</span>
</span></span><span style=display:flex><span>docker run -d <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --name postgres <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --network openfga <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -e <span style=color:#000>POSTGRES_USER</span><span style=color:#ce5c00;font-weight:700>=</span>postgres <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -e <span style=color:#000>POSTGRES_PASSWORD</span><span style=color:#ce5c00;font-weight:700>=</span>password <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -e <span style=color:#000>POSTGRES_DB</span><span style=color:#ce5c00;font-weight:700>=</span>openfga <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  postgres:17
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Run migrations (first time or after upgrades)</span>
</span></span><span style=display:flex><span>docker run --rm <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --network openfga <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  openfga/openfga migrate <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --datastore-engine postgres <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --datastore-uri <span style=color:#4e9a06>&#39;postgres://postgres:password@postgres:5432/openfga&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Run OpenFGA server</span>
</span></span><span style=display:flex><span>docker run -d <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --name openfga <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --network openfga <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -p 8080:8080 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -p 8081:8081 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -p 3000:3000 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -e <span style=color:#000>OPENFGA_DATASTORE_ENGINE</span><span style=color:#ce5c00;font-weight:700>=</span>postgres <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -e <span style=color:#000>OPENFGA_DATASTORE_URI</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;postgres://postgres:password@postgres:5432/openfga&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  openfga/openfga run
</span></span></code></pre></div><h4 id=production-with-mysql>Production with MySQL</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Run MySQL</span>
</span></span><span style=display:flex><span>docker run -d <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --name mysql <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --network openfga <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -e <span style=color:#000>MYSQL_ROOT_PASSWORD</span><span style=color:#ce5c00;font-weight:700>=</span>secret <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -e <span style=color:#000>MYSQL_DATABASE</span><span style=color:#ce5c00;font-weight:700>=</span>openfga <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  mysql:8
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Run migrations</span>
</span></span><span style=display:flex><span>docker run --rm <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --network openfga <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  openfga/openfga migrate <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --datastore-engine mysql <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --datastore-uri <span style=color:#4e9a06>&#39;root:secret@tcp(mysql:3306)/openfga?parseTime=true&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Run OpenFGA server</span>
</span></span><span style=display:flex><span>docker run -d <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --name openfga <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --network openfga <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -p 8080:8080 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -e <span style=color:#000>OPENFGA_DATASTORE_ENGINE</span><span style=color:#ce5c00;font-weight:700>=</span>mysql <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -e <span style=color:#000>OPENFGA_DATASTORE_URI</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;root:secret@tcp(mysql:3306)/openfga?parseTime=true&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  openfga/openfga run
</span></span></code></pre></div><h4 id=production-with-sqlite>Production with SQLite</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Create volume for persistence</span>
</span></span><span style=display:flex><span>docker volume create openfga-data
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Run OpenFGA with SQLite</span>
</span></span><span style=display:flex><span>docker run -d <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --name openfga <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -p 8080:8080 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -v openfga-data:/home/nonroot <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -e <span style=color:#000>OPENFGA_DATASTORE_ENGINE</span><span style=color:#ce5c00;font-weight:700>=</span>sqlite <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -e <span style=color:#000>OPENFGA_DATASTORE_URI</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;/home/nonroot/openfga.db&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  openfga/openfga run
</span></span></code></pre></div><h4 id=docker-compose-example>Docker Compose Example</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;3.8&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>services</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>postgres</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>postgres:17</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>environment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>POSTGRES_USER</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>postgres</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>POSTGRES_PASSWORD</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>password</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>POSTGRES_DB</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>openfga</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>postgres_data:/var/lib/postgresql/data</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>networks</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>openfga</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>openfga-migrate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>openfga/openfga:latest</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>command</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>migrate</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>environment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>OPENFGA_DATASTORE_ENGINE</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>postgres</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>OPENFGA_DATASTORE_URI</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;postgres://postgres:password@postgres:5432/openfga&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>depends_on</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>postgres</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>networks</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>openfga</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>openfga</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>openfga/openfga:latest</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>command</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>run</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>environment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>OPENFGA_DATASTORE_ENGINE</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>postgres</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>OPENFGA_DATASTORE_URI</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;postgres://postgres:password@postgres:5432/openfga&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#4e9a06>&#34;8080:8080&#34;</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># HTTP API</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#4e9a06>&#34;8081:8081&#34;</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># gRPC API</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#4e9a06>&#34;3000:3000&#34;</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># Playground</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>depends_on</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>openfga-migrate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>condition</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>service_completed_successfully</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>networks</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>openfga</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>postgres_data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>networks</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>openfga</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=kubernetes-deployment>Kubernetes Deployment</h3><h4 id=helm-chart-recommended>Helm Chart (Recommended)</h4><p>Official Helm chart available at <a href=https://artifacthub.io/packages/helm/openfga/openfga>ArtifactHub</a>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Add Helm repository</span>
</span></span><span style=display:flex><span>helm repo add openfga https://openfga.github.io/helm-charts
</span></span><span style=display:flex><span>helm repo update
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Install with default settings (memory storage)</span>
</span></span><span style=display:flex><span>helm install openfga openfga/openfga
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Install with PostgreSQL</span>
</span></span><span style=display:flex><span>helm install openfga openfga/openfga <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --set datastore.engine<span style=color:#ce5c00;font-weight:700>=</span>postgres <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --set datastore.uri<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;postgres://user:pass@postgres:5432/openfga&#34;</span>
</span></span></code></pre></div><p><strong>Helm Chart Features:</strong></p><ul><li><strong>High Availability:</strong> Defaults to 3 replicas for production (1 for memory storage)</li><li><strong>Horizontal Scaling:</strong> Support for multiple replicas with persistent datastores</li><li><strong>Service Types:</strong> ClusterIP, NodePort, LoadBalancer options</li><li><strong>Health Probes:</strong> Built-in liveness and readiness probes</li><li><strong>Monitoring:</strong> Integration with Prometheus and Grafana</li><li><strong>Ingress:</strong> Optional ingress configuration for external access</li></ul><h4 id=kubernetes-operators>Kubernetes Operators</h4><p>Multiple operator options available for managing OpenFGA deployments:</p><p><strong>1. ZEISS OpenFGA Operator</strong></p><ul><li>Repository: <a href=https://github.com/ZEISS/openfga-operator>github.com/ZEISS/openfga-operator</a></li><li>Installation via Helm</li><li>Manages OpenFGA lifecycle and configuration</li><li>Custom Resource Definitions (CRDs) for OpenFGA instances</li></ul><p><strong>2. Canonical OpenFGA Operator</strong></p><ul><li>Repository: <a href=https://github.com/canonical/openfga-operator>github.com/canonical/openfga-operator</a></li><li>Juju Charm for Kubernetes</li><li>Integration with Canonical Observability Stack (COS)</li><li>Built-in Grafana dashboards</li><li>Prometheus and Loki alert rules</li><li>Available on <a href=https://charmhub.io/openfga-k8s>Charmhub</a></li></ul><h4 id=sample-kubernetes-deployment>Sample Kubernetes Deployment</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>openfga</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>replicas</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>openfga</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>openfga</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>openfga</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>openfga/openfga:latest</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>args</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;run&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>env</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>OPENFGA_DATASTORE_ENGINE</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;postgres&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>OPENFGA_DATASTORE_URI</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>valueFrom</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>secretKeyRef</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>openfga-db-secret</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>database-uri</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>containerPort</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>8080</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>containerPort</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>8081</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>grpc</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>livenessProbe</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>httpGet</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/healthz</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>8080</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>initialDelaySeconds</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>30</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>periodSeconds</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>readinessProbe</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>httpGet</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/healthz</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>8080</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>initialDelaySeconds</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>periodSeconds</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>---</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Service</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>openfga</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>openfga</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>8080</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>targetPort</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>8080</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>grpc</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>8081</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>targetPort</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>8081</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterIP</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=binary-deployment>Binary Deployment</h3><p>OpenFGA can run as a standalone binary:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Download binary from GitHub releases</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># https://github.com/openfga/openfga/releases</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Run with environment variables</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>OPENFGA_DATASTORE_ENGINE</span><span style=color:#ce5c00;font-weight:700>=</span>postgres
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>OPENFGA_DATASTORE_URI</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;postgres://user:pass@localhost:5432/openfga&#39;</span>
</span></span><span style=display:flex><span>./openfga run
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Or with command-line flags</span>
</span></span><span style=display:flex><span>./openfga run <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --datastore-engine postgres <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --datastore-uri <span style=color:#4e9a06>&#39;postgres://user:pass@localhost:5432/openfga&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Run migrations before first use or after upgrades</span>
</span></span><span style=display:flex><span>./openfga migrate <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --datastore-engine postgres <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --datastore-uri <span style=color:#4e9a06>&#39;postgres://user:pass@localhost:5432/openfga&#39;</span>
</span></span></code></pre></div><h3 id=storage-backend-options>Storage Backend Options</h3><table><thead><tr><th>Storage Backend</th><th>Use Case</th><th>Production Ready</th><th>Data Persistence</th><th>Version Support</th></tr></thead><tbody><tr><td><strong>Memory</strong></td><td>Development, testing</td><td>No</td><td>Lost on restart</td><td>All versions</td></tr><tr><td><strong>PostgreSQL</strong></td><td>Production</td><td>Yes</td><td>Full persistence</td><td>PostgreSQL 14+</td></tr><tr><td><strong>MySQL</strong></td><td>Production</td><td>Yes</td><td>Full persistence</td><td>MySQL 8+</td></tr><tr><td><strong>SQLite</strong></td><td>Small deployments, embedded</td><td>Beta</td><td>File-based persistence</td><td>SQLite 3+</td></tr></tbody></table><p><strong>Production Recommendation:</strong> Use PostgreSQL or MySQL with regular backups. Memory storage is only suitable for development and testing.</p><h3 id=configuration-options>Configuration Options</h3><p>OpenFGA supports configuration via:</p><ol><li><strong>Environment Variables:</strong> Prefixed with <code>OPENFGA_</code> (e.g., <code>OPENFGA_DATASTORE_ENGINE</code>)</li><li><strong>Command-Line Flags:</strong> Prefixed with <code>--</code> (e.g., <code>--datastore-engine</code>)</li><li><strong>Configuration File:</strong> YAML-based configuration for complex setups</li></ol><p><strong>Key Configuration Parameters:</strong></p><ul><li><code>datastore.engine</code>: Storage backend (memory, postgres, mysql, sqlite)</li><li><code>datastore.uri</code>: Database connection string</li><li><code>http.addr</code>: HTTP API listen address (default: 0.0.0.0:8080)</li><li><code>grpc.addr</code>: gRPC API listen address (default: 0.0.0.0:8081)</li><li><code>playground.enabled</code>: Enable web playground (default: true)</li><li><code>playground.port</code>: Playground port (default: 3000)</li><li><code>authn.method</code>: Authentication method (none, preshared, oidc)</li><li><code>log.level</code>: Logging level (debug, info, warn, error)</li></ul><h3 id=security-configuration>Security Configuration</h3><h4 id=pre-shared-keys>Pre-Shared Keys</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run -d <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -e <span style=color:#000>OPENFGA_AUTHN_METHOD</span><span style=color:#ce5c00;font-weight:700>=</span>preshared <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -e <span style=color:#000>OPENFGA_AUTHN_PRESHARED_KEYS</span><span style=color:#ce5c00;font-weight:700>=</span>key1,key2 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  openfga/openfga run
</span></span></code></pre></div><h4 id=oidc-authentication>OIDC Authentication</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run -d <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -e <span style=color:#000>OPENFGA_AUTHN_METHOD</span><span style=color:#ce5c00;font-weight:700>=</span>oidc <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -e <span style=color:#000>OPENFGA_AUTHN_OIDC_ISSUER</span><span style=color:#ce5c00;font-weight:700>=</span>https://auth.example.com <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -e <span style=color:#000>OPENFGA_AUTHN_OIDC_AUDIENCE</span><span style=color:#ce5c00;font-weight:700>=</span>openfga-api <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  openfga/openfga run
</span></span></code></pre></div><h4 id=tls-support>TLS Support</h4><p>Mount certificate files and configure TLS:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run -d <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -v /path/to/certs:/certs <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -e <span style=color:#000>OPENFGA_HTTP_TLS_ENABLED</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -e <span style=color:#000>OPENFGA_HTTP_TLS_CERT</span><span style=color:#ce5c00;font-weight:700>=</span>/certs/server.crt <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -e <span style=color:#000>OPENFGA_HTTP_TLS_KEY</span><span style=color:#ce5c00;font-weight:700>=</span>/certs/server.key <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  openfga/openfga run
</span></span></code></pre></div><h3 id=monitoring-and-profiling>Monitoring and Profiling</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Enable profiling endpoint</span>
</span></span><span style=display:flex><span>docker run -d <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -e <span style=color:#000>OPENFGA_PROFILER_ENABLED</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -e <span style=color:#000>OPENFGA_PROFILER_ADDR</span><span style=color:#ce5c00;font-weight:700>=</span>:3002 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -p 3002:3002 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  openfga/openfga run
</span></span></code></pre></div><p>Access profiling data at <code>http://localhost:3002/debug/pprof/</code></p><h2 id=policy-definition>Policy Definition</h2><p>OpenFGA uses a configuration language to define authorization models. The language supports two formats: a human-friendly DSL and a JSON API format.</p><h3 id=configuration-language-overview>Configuration Language Overview</h3><p><strong>Purpose:</strong> Define the types of objects in your system and how they relate to each other</p><p><strong>Two Formats:</strong></p><ol><li><strong>DSL (Domain Specific Language):</strong> User-friendly syntax for humans</li><li><strong>JSON:</strong> API-compatible format for programmatic use</li></ol><p><strong>Where DSL is Used:</strong></p><ul><li>Playground web interface</li><li>OpenFGA CLI</li><li>VS Code extension</li><li>IntelliJ extension</li></ul><p><strong>Where JSON is Used:</strong></p><ul><li>API calls</li><li>SDK integration</li><li>Programmatic model management</li></ul><h3 id=converting-between-formats>Converting Between Formats</h3><p>Use the OpenFGA CLI to convert:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># DSL to JSON</span>
</span></span><span style=display:flex><span>fga model transform --from dsl --to json
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># JSON to DSL</span>
</span></span><span style=display:flex><span>fga model transform --from json --to dsl
</span></span></code></pre></div><h3 id=dsl-syntax>DSL Syntax</h3><h4 id=basic-structure>Basic Structure</h4><pre tabindex=0><code>model
  schema 1.1

type user

type document
  relations
    define owner: [user]
    define editor: [user]
    define viewer: [user]
    define can_view: viewer or editor or owner
    define can_edit: editor or owner
    define can_delete: owner
</code></pre><p><strong>Key Elements:</strong></p><ul><li><code>model schema 1.1</code>: Schema version declaration</li><li><code>type</code>: Defines an object type</li><li><code>relations</code>: Section containing relationship definitions</li><li><code>define</code>: Declares a relation or computed permission</li><li><code>[user]</code>: Direct relationship type restrictions</li></ul><h4 id=type-definitions>Type Definitions</h4><p>Types represent objects in your system:</p><pre tabindex=0><code>type user                    # Users/subjects
type organization            # Organizations
type bot                     # Battle bots
type game                    # Games/matches
type document                # Documents
type folder                  # Folders
</code></pre><h3 id=relationship-definitions>Relationship Definitions</h3><h4 id=direct-relationships>Direct Relationships</h4><p>Specify which types can be directly assigned to a relation:</p><pre tabindex=0><code>type document
  relations
    define owner: [user]
    define editor: [user, organization#member]
    define viewer: [user, user:*, organization#member]
</code></pre><p><strong>Formats:</strong></p><ul><li><code>[user]</code>: Specific user objects</li><li><code>[user:*]</code>: Any user (public access)</li><li><code>[organization#member]</code>: Users with specific relation on another type</li></ul><h4 id=union-operator-or>Union Operator (<code>or</code>)</h4><p>User has permission if they match ANY condition:</p><pre tabindex=0><code>type document
  relations
    define owner: [user]
    define editor: [user]
    define viewer: [user]
    define can_view: viewer or editor or owner
</code></pre><p>Example tuples:</p><pre tabindex=0><code>user:anne, editor, document:1
</code></pre><p>Result: <code>anne</code> has <code>can_view</code> because she&rsquo;s an <code>editor</code></p><h4 id=intersection-operator-and>Intersection Operator (<code>and</code>)</h4><p>User has permission if they match ALL conditions:</p><pre tabindex=0><code>type document
  relations
    define restricted: [user]
    define approved_viewer: [user]
    define can_view_restricted: approved_viewer and restricted
</code></pre><p>Example tuples:</p><pre tabindex=0><code>user:anne, approved_viewer, document:1
user:anne, restricted, document:1
</code></pre><p>Result: <code>anne</code> has <code>can_view_restricted</code> only if both tuples exist</p><h4 id=exclusion-operator-but-not>Exclusion Operator (<code>but not</code>)</h4><p>Include users from base set while excluding others:</p><pre tabindex=0><code>type document
  relations
    define viewer: [user]
    define blocked: [user]
    define can_view: viewer but not blocked
</code></pre><p>Example tuples:</p><pre tabindex=0><code>user:anne, viewer, document:1
user:bob, viewer, document:1
user:bob, blocked, document:1
</code></pre><p>Result: <code>anne</code> has <code>can_view</code>, but <code>bob</code> does not (blocked)</p><p><strong>Use Cases:</strong></p><ul><li>Block lists</li><li>Revoked access</li><li>Temporary suspensions</li></ul><h4 id=transitivity-from>Transitivity (<code>from</code>)</h4><p>Inherit relationships through related objects:</p><pre tabindex=0><code>type folder
  relations
    define owner: [user]
    define viewer: [user]

type document
  relations
    define parent: [folder]
    define owner: [user] or owner from parent
    define viewer: [user] or viewer from parent
</code></pre><p>Example tuples:</p><pre tabindex=0><code>folder:docs, owner, user:anne
folder:docs, parent, document:readme
</code></pre><p>Result: <code>anne</code> is <code>owner</code> of <code>document:readme</code> (inherited from folder)</p><p><strong>Use Cases:</strong></p><ul><li>Hierarchical permissions (folder → documents)</li><li>Organization membership (org → resources)</li><li>Group-based access (group → members)</li></ul><h3 id=complex-authorization-models>Complex Authorization Models</h3><h4 id=multi-level-hierarchies>Multi-Level Hierarchies</h4><pre tabindex=0><code>model
  schema 1.1

type user

type organization
  relations
    define member: [user]
    define admin: [user]

type team
  relations
    define parent_org: [organization]
    define member: [user] or admin from parent_org
    define admin: [user]

type bot
  relations
    define parent_team: [team]
    define owner: [user] or admin from parent_team
    define can_deploy: owner or admin from parent_team
    define can_configure: owner or admin from parent_team
    define can_view: member from parent_team or owner
</code></pre><p>This model enables:</p><ul><li>Organization admins automatically have admin rights on all teams</li><li>Team admins can deploy and configure bots</li><li>Team members can view bots</li><li>Bot owners have full control</li></ul><h4 id=battle-bots-example>Battle Bots Example</h4><pre tabindex=0><code>model
  schema 1.1

type user

type organization
  relations
    define member: [user]
    define owner: [user]
    define admin: [user] or owner
    define can_invite_members: admin
    define can_create_teams: admin or member

type team
  relations
    define parent_org: [organization]
    define member: [user] or admin from parent_org
    define admin: [user]
    define can_manage_bots: admin or admin from parent_org

type bot
  relations
    define parent_team: [team]
    define creator: [user]
    define can_edit: creator or can_manage_bots from parent_team
    define can_delete: creator or admin from parent_team
    define can_deploy: creator or can_manage_bots from parent_team
    define can_view: member from parent_team

type game
  relations
    define participant_bot: [bot]
    define creator: [user]
    define can_view: creator or can_view from participant_bot
</code></pre><h3 id=json-format-example>JSON Format Example</h3><p>The same model in JSON API format:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;schema_version&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;1.1&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;type_definitions&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;user&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;document&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&#34;relations&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;owner&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>&#34;this&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{}</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;editor&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>&#34;this&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{}</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;viewer&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>&#34;this&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{}</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;can_view&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>&#34;union&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;child&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>              <span style=color:#000;font-weight:700>{</span><span style=color:#204a87;font-weight:700>&#34;this&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{}},</span>
</span></span><span style=display:flex><span>              <span style=color:#000;font-weight:700>{</span><span style=color:#204a87;font-weight:700>&#34;computedUserset&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span><span style=color:#204a87;font-weight:700>&#34;relation&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;editor&#34;</span><span style=color:#000;font-weight:700>}},</span>
</span></span><span style=display:flex><span>              <span style=color:#000;font-weight:700>{</span><span style=color:#204a87;font-weight:700>&#34;computedUserset&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span><span style=color:#204a87;font-weight:700>&#34;relation&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;owner&#34;</span><span style=color:#000;font-weight:700>}}</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>          <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&#34;metadata&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;relations&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>&#34;owner&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;directly_related_user_types&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>              <span style=color:#000;font-weight:700>{</span><span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;user&#34;</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>          <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>&#34;editor&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;directly_related_user_types&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>              <span style=color:#000;font-weight:700>{</span><span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;user&#34;</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>          <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>&#34;viewer&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;directly_related_user_types&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>              <span style=color:#000;font-weight:700>{</span><span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;user&#34;</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>          <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=testing-authorization-models>Testing Authorization Models</h3><h4 id=assertions>Assertions</h4><p>Define expected behavior to prevent regressions:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># model_test.yaml</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Document Permissions Test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>model</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  model
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    schema 1.1
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  type user
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  type document
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    relations
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      define owner: [user]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      define viewer: [user]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      define can_view: viewer or owner</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>tuples</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>user:anne</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>relation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>owner</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>object</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>document:1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>user:bob</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>relation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>viewer</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>object</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>document:2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>assertions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># Positive assertions</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>check</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>user:anne</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>relation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>can_view</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>object</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>document:1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>expected</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># Negative assertions</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>check</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>user:bob</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>relation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>can_view</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>object</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>document:1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>expected</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Run tests with OpenFGA CLI:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>fga model <span style=color:#204a87>test</span> --file model_test.yaml
</span></span></code></pre></div><h3 id=modeling-best-practices>Modeling Best Practices</h3><ol><li><strong>Start Simple:</strong> Begin with most critical feature, iterate to add complexity</li><li><strong>Use Meaningful Names:</strong> Relation names should clearly indicate permission (e.g., <code>can_edit</code> not just <code>edit</code>)</li><li><strong>Leverage Inheritance:</strong> Use <code>from</code> operator to avoid duplicating relationships</li><li><strong>Test Thoroughly:</strong> Write assertions for expected and unexpected behaviors</li><li><strong>Version Models:</strong> Track changes to authorization models like code</li><li><strong>Document Decisions:</strong> Explain why relations are structured a certain way</li></ol><h3 id=tools-for-modeling>Tools for Modeling</h3><ul><li><strong>Playground:</strong> Web UI at <code>http://localhost:3000</code> for interactive modeling</li><li><strong>CLI:</strong> Command-line tool for model management and testing</li><li><strong>VS Code Extension:</strong> Syntax highlighting and validation</li><li><strong>IntelliJ Extension:</strong> IDE integration for JetBrains products</li></ul><h2 id=dynamic-data-and-contextual-tuples>Dynamic Data and Contextual Tuples</h2><p>OpenFGA supports dynamic authorization decisions through contextual tuples, enabling runtime data to influence authorization without storing relationships permanently.</p><h3 id=what-are-contextual-tuples>What are Contextual Tuples?</h3><p><strong>Definition:</strong> Contextual tuples are temporary relationship tuples provided at query time that exist only for the duration of a specific authorization check.</p><p><strong>Key Characteristics:</strong></p><ul><li>Not persisted to the database</li><li>Provided with each Check, BatchCheck, ListObjects, ListUsers, or Expand request</li><li>Treated as if they exist in the store during evaluation</li><li>Override database tuples if the same relationship exists</li><li>Limited to 100 tuples per request</li></ul><h3 id=how-contextual-tuples-work>How Contextual Tuples Work</h3><h4 id=normal-authorization-check-stored-tuples>Normal Authorization Check (Stored Tuples)</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Relationship stored in database
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>await</span> <span style=color:#000>fgaClient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>write</span><span style=color:#000;font-weight:700>({</span>
</span></span><span style=display:flex><span>  <span style=color:#000>writes</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;user:anne&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000>relation</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;member&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000>object</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;organization:acme&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Authorization check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>allowed</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>await</span> <span style=color:#000>fgaClient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>check</span><span style=color:#000;font-weight:700>({</span>
</span></span><span style=display:flex><span>  <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;user:anne&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>relation</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;can_manage_bots&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>object</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;bot:battle-bot-1&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>});</span>
</span></span></code></pre></div><h4 id=with-contextual-tuples-dynamic-data>With Contextual Tuples (Dynamic Data)</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// No pre-stored relationship needed
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Context provided at query time
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>allowed</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>await</span> <span style=color:#000>fgaClient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>check</span><span style=color:#000;font-weight:700>({</span>
</span></span><span style=display:flex><span>  <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;user:anne&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>relation</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;can_manage_bots&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>object</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;bot:battle-bot-1&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>contextualTuples</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;user:anne&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000>relation</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;member&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000>object</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;organization:acme&#34;</span>  <span style=color:#8f5902;font-style:italic>// Dynamic context
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>});</span>
</span></span></code></pre></div><h3 id=use-cases>Use Cases</h3><h4 id=1-multi-tenancy--organization-context>1. Multi-Tenancy / Organization Context</h4><p>User works in multiple organizations; current context comes from session/JWT:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// JWT payload contains current organization
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>token</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>sub</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;user:anne&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>current_org</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;org:acme&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>orgs</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;org:acme&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;org:techcorp&#34;</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>};</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Authorization check uses JWT org context
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>allowed</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>await</span> <span style=color:#000>fgaClient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>check</span><span style=color:#000;font-weight:700>({</span>
</span></span><span style=display:flex><span>  <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>token</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>sub</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>relation</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;can_manage_bots&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>object</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;bot:battle-bot-1&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>contextualTuples</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>token</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>sub</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000>relation</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;active_member&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000>object</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>token</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>current_org</span>  <span style=color:#8f5902;font-style:italic>// From JWT
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>});</span>
</span></span></code></pre></div><p><strong>Authorization Model:</strong></p><pre tabindex=0><code>type organization
  relations
    define member: [user]
    define active_member: [user]

type bot
  relations
    define parent_org: [organization]
    define can_manage: active_member from parent_org
</code></pre><p><strong>Benefits:</strong></p><ul><li>User can switch organizations without changing stored relationships</li><li>Same user session, different authorization context</li><li>No need to write/delete relationships on org switch</li></ul><h4 id=2-avoiding-data-synchronization>2. Avoiding Data Synchronization</h4><p>Some authorization data lives in external systems (identity provider, HR system):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// User roles come from external IAM system
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>externalRoles</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>await</span> <span style=color:#000>iamSystem</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getUserRoles</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>userId</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Use contextual tuples instead of syncing to OpenFGA
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>contextualTuples</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>externalRoles</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>map</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>role</span> <span style=color:#000;font-weight:700>=&gt;</span> <span style=color:#000;font-weight:700>({</span>
</span></span><span style=display:flex><span>  <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>`user:</span><span style=color:#4e9a06>${</span><span style=color:#000>userId</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>`</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>relation</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;member&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>object</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>`role:</span><span style=color:#4e9a06>${</span><span style=color:#000>role</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>id</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>`</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}));</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>allowed</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>await</span> <span style=color:#000>fgaClient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>check</span><span style=color:#000;font-weight:700>({</span>
</span></span><span style=display:flex><span>  <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>`user:</span><span style=color:#4e9a06>${</span><span style=color:#000>userId</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>`</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>relation</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;can_deploy&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>object</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;bot:battle-bot-1&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>contextualTuples</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>});</span>
</span></span></code></pre></div><p><strong>Benefits:</strong></p><ul><li>No dual-write coordination</li><li>Single source of truth in external system</li><li>Always current data without sync delays</li></ul><h4 id=3-time-based-access>3. Time-Based Access</h4><p>Authorization depends on current time (though conditional relationships are preferred):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>now</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#204a87>Date</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>isBusinessHours</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>now</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getHours</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>&gt;=</span> <span style=color:#0000cf;font-weight:700>9</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#000>now</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getHours</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>&lt;</span> <span style=color:#0000cf;font-weight:700>17</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>contextualTuples</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[];</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>isBusinessHours</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>contextualTuples</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>push</span><span style=color:#000;font-weight:700>({</span>
</span></span><span style=display:flex><span>    <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;user:anne&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>relation</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;business_hours_user&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>object</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;system:battlebots&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>});</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>allowed</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>await</span> <span style=color:#000>fgaClient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>check</span><span style=color:#000;font-weight:700>({</span>
</span></span><span style=display:flex><span>  <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;user:anne&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>relation</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;can_deploy_to_production&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>object</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;bot:battle-bot-1&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>contextualTuples</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>});</span>
</span></span></code></pre></div><p><strong>Authorization Model:</strong></p><pre tabindex=0><code>type system
  relations
    define business_hours_user: [user]

type bot
  relations
    define can_deploy_to_production: business_hours_user from parent_system
</code></pre><h4 id=4-ip-based-or-location-restrictions>4. IP-Based or Location Restrictions</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>userIp</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>request</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ip</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>isInternalNetwork</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>ipRangeCheck</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>userIp</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;10.0.0.0/8&#34;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>contextualTuples</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[];</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>isInternalNetwork</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>contextualTuples</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>push</span><span style=color:#000;font-weight:700>({</span>
</span></span><span style=display:flex><span>    <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>`user:</span><span style=color:#4e9a06>${</span><span style=color:#000>userId</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>`</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>relation</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;internal_network_user&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>object</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;network:corporate&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>});</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>allowed</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>await</span> <span style=color:#000>fgaClient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>check</span><span style=color:#000;font-weight:700>({</span>
</span></span><span style=display:flex><span>  <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>`user:</span><span style=color:#4e9a06>${</span><span style=color:#000>userId</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>`</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>relation</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;can_access_admin_panel&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>object</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;system:battlebots&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>contextualTuples</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>});</span>
</span></span></code></pre></div><h4 id=5-disambiguating-multiple-relationships>5. Disambiguating Multiple Relationships</h4><p>User has multiple relationships with same object; specify which applies:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// User is member of multiple teams
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Specify which team context for this request
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>allowed</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>await</span> <span style=color:#000>fgaClient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>check</span><span style=color:#000;font-weight:700>({</span>
</span></span><span style=display:flex><span>  <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;user:anne&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>relation</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;can_view_metrics&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>object</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;dashboard:team-performance&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>contextualTuples</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;user:anne&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000>relation</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;viewing_as_member&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000>object</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;team:red-team&#34;</span>  <span style=color:#8f5902;font-style:italic>// Which team context
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>});</span>
</span></span></code></pre></div><h3 id=contextual-tuples-api-examples>Contextual Tuples API Examples</h3><h4 id=nodejs-sdk>Node.js SDK</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>OpenFgaClient</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>require</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;@openfga/sdk&#39;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>fgaClient</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>OpenFgaClient</span><span style=color:#000;font-weight:700>({</span>
</span></span><span style=display:flex><span>  <span style=color:#000>apiUrl</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>process</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>env</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>FGA_API_URL</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>storeId</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>process</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>env</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>FGA_STORE_ID</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>authorizationModelId</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>process</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>env</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>FGA_MODEL_ID</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Check with contextual tuples
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>response</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>await</span> <span style=color:#000>fgaClient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>check</span><span style=color:#000;font-weight:700>({</span>
</span></span><span style=display:flex><span>  <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;user:anne&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>relation</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;can_edit&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>object</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;document:1&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>contextualTuples</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;user:anne&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000>relation</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;member&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000>object</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;organization:acme&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;organization:acme&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000>relation</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;owner&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000>object</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;document:1&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>response</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>allowed</span><span style=color:#000;font-weight:700>);</span> <span style=color:#8f5902;font-style:italic>// true or false
</span></span></span></code></pre></div><h4 id=go-sdk>Go SDK</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#4e9a06>&#34;context&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#4e9a06>&#34;github.com/openfga/go-sdk/client&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>func</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>checkWithContext</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>userId</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>botId</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>orgId</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>bool</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>resp</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>err</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>:=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>fgaClient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Check</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Background</span><span style=color:#000;font-weight:700>()).</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>Body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>client</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ClientCheckRequest</span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000>User</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Sprintf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;user:%s&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>userId</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000>Relation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;can_deploy&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000>Object</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Sprintf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;bot:%s&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>botId</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000>ContextualTuples</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[]</span><span style=color:#000>client</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ClientTupleKey</span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#000>User</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Sprintf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;user:%s&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>userId</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#000>Relation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;active_member&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#000>Object</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Sprintf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;organization:%s&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>orgId</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000;font-weight:700>},</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000;font-weight:700>},</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>}).</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>Execute</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>if</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>err</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>!=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>nil</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>err</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>resp</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetAllowed</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>nil</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=rest-api>REST API</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -X POST http://localhost:8080/stores/<span style=color:#4e9a06>${</span><span style=color:#000>STORE_ID</span><span style=color:#4e9a06>}</span>/check <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -d <span style=color:#4e9a06>&#39;{
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    &#34;authorization_model_id&#34;: &#34;${MODEL_ID}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    &#34;tuple_key&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      &#34;user&#34;: &#34;user:anne&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      &#34;relation&#34;: &#34;can_edit&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      &#34;object&#34;: &#34;document:1&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    },
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    &#34;contextual_tuples&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      &#34;tuple_keys&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        {
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          &#34;user&#34;: &#34;user:anne&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          &#34;relation&#34;: &#34;member&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          &#34;object&#34;: &#34;organization:acme&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        }
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      ]
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    }
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  }&#39;</span>
</span></span></code></pre></div><h3 id=limitations-and-considerations>Limitations and Considerations</h3><h4 id=hard-limits>Hard Limits</h4><table><thead><tr><th>Limitation</th><th>Value</th><th>Reason</th></tr></thead><tbody><tr><td><strong>Maximum contextual tuples</strong></td><td>100 per request</td><td>Performance and complexity bounds</td></tr><tr><td><strong>Tuple lifetime</strong></td><td>Single request</td><td>Not persisted to database</td></tr><tr><td><strong>Validation</strong></td><td>Same as stored tuples</td><td>Must conform to authorization model</td></tr></tbody></table><h4 id=precedence-rules>Precedence Rules</h4><p>When both a contextual tuple and stored tuple exist with same user, relation, and object:</p><p><strong>Contextual tuple takes precedence</strong> and stored tuple is ignored for that check.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Database has:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// user:anne, viewer, document:1
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Check with contextual tuple:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>allowed</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>await</span> <span style=color:#000>fgaClient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>check</span><span style=color:#000;font-weight:700>({</span>
</span></span><span style=display:flex><span>  <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;user:anne&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>relation</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;can_edit&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>object</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;document:1&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>contextualTuples</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;user:anne&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000>relation</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;editor&#34;</span><span style=color:#000;font-weight:700>,</span>  <span style=color:#8f5902;font-style:italic>// Different relation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>      <span style=color:#000>object</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;document:1&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>});</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Evaluation uses contextual &#34;editor&#34; relation, not stored &#34;viewer&#34;
</span></span></span></code></pre></div><h4 id=performance-considerations>Performance Considerations</h4><p><strong>Pros:</strong></p><ul><li>Avoids database writes for temporary/dynamic data</li><li>Reduces data synchronization complexity</li><li>Enables runtime-dependent authorization</li></ul><p><strong>Cons:</strong></p><ul><li>Increases request payload size</li><li>Cannot be indexed or optimized like stored tuples</li><li>May increase check latency for complex models</li><li>Requires client to provide context data</li></ul><p><strong>Recommendation:</strong> Use contextual tuples for truly dynamic data. For stable relationships, store tuples in database for better performance.</p><h4 id=security-considerations>Security Considerations</h4><p><strong>Trust Boundary:</strong> Application must validate contextual tuple data before sending to OpenFGA.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// ❌ DANGEROUS: Using user-provided data directly
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>allowed</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>await</span> <span style=color:#000>fgaClient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>check</span><span style=color:#000;font-weight:700>({</span>
</span></span><span style=display:flex><span>  <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>currentUser</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>relation</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;can_delete&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>object</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>targetBot</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>contextualTuples</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>req</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>body</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>context</span>  <span style=color:#8f5902;font-style:italic>// User controls this!
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000;font-weight:700>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// ✅ SAFE: Validate and construct context from trusted sources
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>orgId</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>await</span> <span style=color:#000>getValidatedOrgFromSession</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>req</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>allowed</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>await</span> <span style=color:#000>fgaClient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>check</span><span style=color:#000;font-weight:700>({</span>
</span></span><span style=display:flex><span>  <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>currentUser</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>relation</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;can_delete&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>object</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>targetBot</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>contextualTuples</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>currentUser</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000>relation</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;member&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000>object</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>`organization:</span><span style=color:#4e9a06>${</span><span style=color:#000>orgId</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>`</span>  <span style=color:#8f5902;font-style:italic>// Validated
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>});</span>
</span></span></code></pre></div><p><strong>Token Expiration Issue:</strong> If using JWT claims as contextual tuples, access continues until token expires even if underlying claims change in identity provider.</p><p><strong>Mitigation:</strong> Use short-lived tokens or implement token revocation checking.</p><h3 id=best-practices>Best Practices</h3><ol><li><strong>Use for Truly Dynamic Data:</strong> Session context, current time, IP address, temporary grants</li><li><strong>Store Stable Relationships:</strong> User-organization membership, resource ownership, team membership</li><li><strong>Validate Context Data:</strong> Never trust user-provided contextual tuples</li><li><strong>Limit Contextual Tuple Count:</strong> Stay well below 100-tuple limit for performance</li><li><strong>Document Context Requirements:</strong> Make clear what context is needed for each authorization check</li><li><strong>Cache When Appropriate:</strong> Some dynamic data can be cached short-term to reduce computation</li></ol><h2 id=integration-patterns-for-battle-bots>Integration Patterns for Battle Bots</h2><h3 id=recommended-architecture>Recommended Architecture</h3><pre tabindex=0><code>┌─────────────────────────────────────────────────────────┐
│                   Battle Bots Platform                   │
├─────────────────────────────────────────────────────────┤
│                                                           │
│  ┌──────────────┐      ┌──────────────┐                 │
│  │   Frontend   │      │  API Gateway  │                 │
│  │  (React/etc) │─────▶│   (Go)        │                 │
│  └──────────────┘      └───────┬───────┘                 │
│                                │                          │
│                                ▼                          │
│                    ┌───────────────────────┐             │
│                    │ Auth Middleware       │             │
│                    │ 1. Verify JWT         │             │
│                    │ 2. Extract user ID    │             │
│                    └───────────┬───────────┘             │
│                                │                          │
│                                ▼                          │
│                    ┌───────────────────────┐             │
│                    │ AuthZ Middleware      │             │
│                    │ 1. Map operation      │             │
│                    │ 2. Call OpenFGA       │             │
│                    │ 3. Allow/Deny         │             │
│                    └───────────┬───────────┘             │
│                                │                          │
│                    ┌───────────▼───────────┐             │
│                    │   Business Logic      │             │
│                    │   - Bot Management    │             │
│                    │   - Game Services     │             │
│                    │   - Team Management   │             │
│                    └───────────────────────┘             │
│                                                           │
└─────────────────────────────────────────────────────────┘
         │                              │
         │ GitHub OAuth                 │ gRPC/HTTP
         ▼                              ▼
┌─────────────────┐          ┌─────────────────┐
│  GitHub OAuth   │          │    OpenFGA      │
│                 │          │  - PostgreSQL   │
│                 │          │  - K8s/Docker   │
└─────────────────┘          └─────────────────┘
</code></pre><h3 id=example-bot-deployment-authorization>Example: Bot Deployment Authorization</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// middleware/authz.go</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>package</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>middleware</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#4e9a06>&#34;context&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#4e9a06>&#34;fmt&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#4e9a06>&#34;github.com/gofiber/fiber/v2&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>fgaClient</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;github.com/openfga/go-sdk/client&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AuthZMiddleware</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>struct</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>fga</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>fgaClient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>OpenFgaClient</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>func</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>AuthZMiddleware</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>RequirePermission</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>resourceType</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>relation</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>fiber</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Handler</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>c</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>fiber</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Ctx</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>error</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic>// Extract user from JWT (set by auth middleware)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>userID</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>:=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Locals</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;userID&#34;</span><span style=color:#000;font-weight:700>).(</span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic>// Get resource ID from route params</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>resourceID</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>:=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Params</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;id&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic>// Construct OpenFGA object</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>object</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>:=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Sprintf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;%s:%s&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>resourceType</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>resourceID</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>user</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>:=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Sprintf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;user:%s&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>userID</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic>// Check authorization</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>resp</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>err</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>:=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>fga</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Check</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Background</span><span style=color:#000;font-weight:700>()).</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000>Body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>fgaClient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ClientCheckRequest</span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000>User</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#000>user</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000>Relation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>relation</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000>Object</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>object</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000;font-weight:700>}).</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000>Execute</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>if</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>err</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>!=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>nil</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Status</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>500</span><span style=color:#000;font-weight:700>).</span><span style=color:#000>JSON</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>fiber</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Map</span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#4e9a06>&#34;error&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;Authorization check failed&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>if</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>!</span><span style=color:#000>resp</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetAllowed</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Status</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>403</span><span style=color:#000;font-weight:700>).</span><span style=color:#000>JSON</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>fiber</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Map</span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#4e9a06>&#34;error&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;Forbidden&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Next</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// Usage in routes</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>app</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Post</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;/bots/:id/deploy&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>authMiddleware</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Authenticate</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>authzMiddleware</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RequirePermission</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;bot&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;can_deploy&#34;</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>handlers</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>DeployBot</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=relationship-management>Relationship Management</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// services/organization.go</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>func</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>s</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>OrgService</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AddTeamMember</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>ctx</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>teamID</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>userID</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>error</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// Write relationship to OpenFGA</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>_</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>err</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>:=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>s</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>fga</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Write</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>).</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>Body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>fgaClient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ClientWriteRequest</span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000>Writes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[]</span><span style=color:#000>fgaClient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ClientTupleKey</span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#000>User</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Sprintf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;user:%s&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>userID</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#000>Relation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;member&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#000>Object</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Sprintf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;team:%s&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>teamID</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000;font-weight:700>},</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000;font-weight:700>},</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>}).</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>Execute</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>err</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>func</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>s</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>OrgService</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>RemoveTeamMember</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>ctx</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>teamID</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>userID</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>error</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// Delete relationship from OpenFGA</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>_</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>err</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>:=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>s</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>fga</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Write</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>).</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>Body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>fgaClient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ClientWriteRequest</span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000>Deletes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[]</span><span style=color:#000>fgaClient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ClientTupleKey</span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#000>User</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Sprintf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;user:%s&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>userID</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#000>Relation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;member&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#000>Object</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Sprintf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;team:%s&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>teamID</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000;font-weight:700>},</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000;font-weight:700>},</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>}).</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>Execute</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>err</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=pros-and-cons-for-battle-bots>Pros and Cons for Battle Bots</h2><h3 id=pros-of-using-openfga>Pros of Using OpenFGA</h3><ol><li><p><strong>Fine-Grained Authorization</strong></p><ul><li>Object-level permissions instead of coarse role-based access</li><li>Can express complex relationships (org → team → bot → game)</li><li>Supports hierarchical permission inheritance</li><li>Scales to millions of authorization decisions per second</li></ul></li><li><p><strong>Separation of Concerns</strong></p><ul><li>Authentication (GitHub OAuth + JWT) completely separate from authorization</li><li>OpenFGA focuses solely on &ldquo;who can do what&rdquo;</li><li>Clean architecture with well-defined boundaries</li></ul></li><li><p><strong>Flexible and Expressive</strong></p><ul><li>Model any relationship pattern (ReBAC, RBAC, ABAC hybrid)</li><li>Union, intersection, exclusion, transitivity operators</li><li>Contextual tuples for dynamic authorization</li><li>Easy to evolve authorization model over time</li></ul></li><li><p><strong>Production-Ready</strong></p><ul><li>Inspired by Google Zanzibar (battle-tested at massive scale)</li><li>High performance with proper database backend</li><li>Horizontal scaling with stateless API servers</li><li>Multiple deployment options (Docker, K8s, binary)</li></ul></li><li><p><strong>Developer Experience</strong></p><ul><li>Intuitive DSL for modeling</li><li>SDKs for Go, JavaScript, Python, .NET, Java</li><li>Playground for testing models</li><li>CLI for model management and testing</li><li>IDE extensions (VS Code, IntelliJ)</li></ul></li><li><p><strong>Open Source</strong></p><ul><li>Apache 2.0 license</li><li>No vendor lock-in</li><li>Self-hosted (no per-user costs)</li><li>Active community and development</li><li>Backed by Okta/Auth0 but truly open</li></ul></li><li><p><strong>Multi-Tenancy Native</strong></p><ul><li>Perfect for organization/team/bot hierarchy</li><li>Contextual tuples for session-based org context</li><li>Clean permission inheritance across tenants</li></ul></li><li><p><strong>Auditability</strong></p><ul><li>All relationship changes can be logged</li><li>Query history for &ldquo;why can user X access Y?&rdquo;</li><li>Compliance-friendly authorization tracking</li></ul></li></ol><h3 id=cons-of-using-openfga>Cons of Using OpenFGA</h3><ol><li><p><strong>Additional Infrastructure</strong></p><ul><li>Requires separate service deployment</li><li>Database dependency (PostgreSQL/MySQL for production)</li><li>Monitoring and maintenance overhead</li><li>Network hop for authorization checks</li></ul></li><li><p><strong>Learning Curve</strong></p><ul><li>ReBAC is different from traditional RBAC</li><li>Authorization modeling requires thoughtful design</li><li>Team must understand relationship-based concepts</li><li>DSL syntax learning required</li></ul></li><li><p><strong>Performance Considerations</strong></p><ul><li>Every protected operation requires OpenFGA call</li><li>Network latency added to request path</li><li>Complex models can have slower evaluation times</li><li>Requires caching strategy for hot paths</li></ul></li><li><p><strong>Operational Complexity</strong></p><ul><li>Another service to deploy, monitor, and scale</li><li>Database backup and migration procedures</li><li>Version management for authorization models</li><li>Need observability into authorization decisions</li></ul></li><li><p><strong>May Be Overkill for MVP</strong></p><ul><li>Simple RBAC might suffice initially</li><li>Early-stage apps may not need fine-grained permissions</li><li>Added complexity before product-market fit</li><li>Could implement later when requirements are clearer</li></ul></li><li><p><strong>Data Consistency Challenges</strong></p><ul><li>Must keep OpenFGA relationships in sync with application data</li><li>Deleting resources requires cleaning up relationships</li><li>Risk of orphaned tuples if cleanup fails</li><li>Eventual consistency considerations</li></ul></li><li><p><strong>Limited ABAC Support</strong></p><ul><li>Primarily relationship-based, not attribute-based</li><li>Contextual tuples help but have limitations</li><li>Cannot directly query external attributes during evaluation</li><li>May need hybrid approach for complex ABAC requirements</li></ul></li></ol><h2 id=recommendations-for-battle-bots>Recommendations for Battle Bots</h2><h3 id=recommendation-1-adopt-openfga-for-authorization>Recommendation 1: Adopt OpenFGA for Authorization</h3><p><strong>Rationale:</strong></p><ul><li>Battle Bots has inherent hierarchy (org → team → bot → game)</li><li>Fine-grained permissions are required (not all team members should deploy bots)</li><li>Self-hosted OpenFGA aligns with control requirements</li><li>Go platform matches well with OpenFGA&rsquo;s Go SDK</li><li>No per-user costs (important for platform growth)</li></ul><p><strong>When to Implement:</strong></p><ul><li>Design authorization model during MVP planning phase</li><li>Implement alongside GitHub OAuth authentication</li><li>Deploy before adding multi-user features</li></ul><p><strong>Implementation Approach:</strong></p><ol><li>Define authorization model for MVP (orgs, teams, bots)</li><li>Deploy OpenFGA with PostgreSQL on Kubernetes</li><li>Implement authorization middleware for all protected resources</li><li>Write relationships when resources are created/modified</li><li>Monitor and optimize based on usage patterns</li></ol><h3 id=recommendation-2-start-simple-iterate>Recommendation 2: Start Simple, Iterate</h3><p><strong>Phase 1: Basic Permissions (MVP)</strong></p><pre tabindex=0><code>- Organization owners can create teams
- Team admins can manage bots
- Bot creators can edit/deploy their bots
- Team members can view team bots
</code></pre><p><strong>Phase 2: Advanced Permissions</strong></p><pre tabindex=0><code>- Delegation (team admins grant deploy rights)
- Shared bots (multiple teams)
- Temporary access grants
- Audit logs
</code></pre><p><strong>Phase 3: Complex Scenarios</strong></p><pre tabindex=0><code>- Tournament organizers
- Spectator access controls
- Sponsor/partner access
- API rate limiting by permission tier
</code></pre><h3 id=recommendation-3-design-authorization-model-carefully>Recommendation 3: Design Authorization Model Carefully</h3><p><strong>Avoid Over-Modeling:</strong></p><ul><li>Don&rsquo;t model every possible permission from day one</li><li>Start with clear use cases</li><li>Add relations as needed</li><li>Test model thoroughly before production</li></ul><p><strong>Example Starter Model for Battle Bots:</strong></p><pre tabindex=0><code>model
  schema 1.1

type user

type organization
  relations
    define owner: [user]
    define member: [user]
    define can_create_teams: owner or member
    define can_invite_members: owner

type team
  relations
    define parent_org: [organization]
    define admin: [user]
    define member: [user] or admin or owner from parent_org
    define can_manage_bots: admin or owner from parent_org

type bot
  relations
    define parent_team: [team]
    define creator: [user]
    define can_view: member from parent_team
    define can_edit: creator or can_manage_bots from parent_team
    define can_deploy: creator or can_manage_bots from parent_team
    define can_delete: creator or admin from parent_team
</code></pre><h3 id=recommendation-4-implement-caching>Recommendation 4: Implement Caching</h3><p><strong>Authorization Check Caching:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Cache authorization decisions for short periods</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AuthCache</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>struct</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>cache</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>ttlcache</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Cache</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>func</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>c</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>AuthCache</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Check</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>user</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>relation</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>object</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>bool</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// Check cache first</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>key</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>:=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Sprintf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;%s:%s:%s&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>user</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>relation</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>object</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>if</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cached</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>found</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>:=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>cache</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Get</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>key</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>found</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cached</span><span style=color:#000;font-weight:700>.(</span><span style=color:#204a87;font-weight:700>bool</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>nil</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// Call OpenFGA</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>allowed</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>err</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>:=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>fgaCheck</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>user</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>relation</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>object</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>if</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>err</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>!=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>nil</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>err</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// Cache for 30 seconds</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>cache</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Set</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>key</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>allowed</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>30</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>time</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Second</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>allowed</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>nil</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p><strong>When to Invalidate:</strong></p><ul><li>User permissions change</li><li>Resource relationships modified</li><li>Organization membership updated</li></ul><h3 id=recommendation-5-monitor-openfga-performance>Recommendation 5: Monitor OpenFGA Performance</h3><p><strong>Metrics to Track:</strong></p><ul><li>Authorization check latency (p50, p95, p99)</li><li>Check throughput (requests/second)</li><li>Model evaluation complexity</li><li>Cache hit rates</li><li>Database query performance</li></ul><p><strong>Alerting Thresholds:</strong></p><ul><li>Check latency > 100ms (p95)</li><li>Error rate > 1%</li><li>Database connection pool exhaustion</li><li>Tuple write failures</li></ul><h3 id=recommendation-6-plan-for-model-evolution>Recommendation 6: Plan for Model Evolution</h3><p><strong>Version Control:</strong></p><ul><li>Store authorization models in git</li><li>Test model changes thoroughly</li><li>Use separate stores for dev/staging/prod</li><li>Document model changes in ADRs</li></ul><p><strong>Migration Strategy:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Test new model in playground/staging</span>
</span></span><span style=display:flex><span>fga model write --file new-model.fga --store-id staging
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Run validation tests</span>
</span></span><span style=display:flex><span>fga model <span style=color:#204a87>test</span> --file model_test.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Deploy to production</span>
</span></span><span style=display:flex><span>fga model write --file new-model.fga --store-id production
</span></span></code></pre></div><h2 id=alternative-considerations>Alternative Considerations</h2><h3 id=alternative-1-ory-keto>Alternative 1: Ory Keto</h3><p><strong>Pros:</strong></p><ul><li>Similar to OpenFGA (also Zanzibar-inspired)</li><li>Part of Ory ecosystem (with Kratos, Hydra)</li><li>Open source (Apache 2.0)</li></ul><p><strong>Cons:</strong></p><ul><li>Less mature than OpenFGA</li><li>Smaller community</li><li>Fewer SDKs and tools</li></ul><h3 id=alternative-2-spicedb>Alternative 2: SpiceDB</h3><p><strong>Pros:</strong></p><ul><li>Also Zanzibar-inspired</li><li>Strong consistency guarantees</li><li>Built-in schema validation</li></ul><p><strong>Cons:</strong></p><ul><li>More complex deployment</li><li>Requires CockroachDB or PostgreSQL</li><li>Different query language</li></ul><h3 id=alternative-3-custom-authorization-service>Alternative 3: Custom Authorization Service</h3><p><strong>Pros:</strong></p><ul><li>Full control over implementation</li><li>Optimized for specific use case</li><li>No external dependencies</li></ul><p><strong>Cons:</strong></p><ul><li>Significant development time</li><li>Security burden on team</li><li>Difficult to evolve</li><li>Reinventing proven solutions</li></ul><p><strong>Verdict:</strong> OpenFGA provides the best balance of features, maturity, and operational simplicity for Battle Bots.</p><h2 id=conclusion>Conclusion</h2><p>OpenFGA is a production-ready, scalable authorization system that fits Battle Bots&rsquo; requirements exceptionally well. Its separation from authentication allows seamless integration with the planned GitHub OAuth strategy, while its ReBAC model naturally represents the platform&rsquo;s organizational hierarchy (organizations → teams → bots → games).</p><p><strong>Key Takeaways:</strong></p><ol><li><strong>JWT Integration:</strong> OpenFGA works alongside JWT authentication, using extracted user identity for authorization checks</li><li><strong>Deployment Flexibility:</strong> Multiple options (Docker, Kubernetes Helm charts, operators, binary) for various environments</li><li><strong>Intuitive Policy Definition:</strong> DSL provides human-readable authorization models that compile to JSON for API use</li><li><strong>Dynamic Authorization:</strong> Contextual tuples enable runtime data (session context, time, location) to influence decisions</li></ol><p><strong>Recommended Path Forward:</strong></p><ol><li>Design authorization model during planning phase</li><li>Deploy OpenFGA on Kubernetes with PostgreSQL</li><li>Start with simple permissions, iterate based on user needs</li><li>Implement caching for performance</li><li>Monitor and optimize as platform scales</li></ol><p>OpenFGA&rsquo;s self-hosted nature eliminates per-user costs while providing enterprise-grade authorization capabilities, making it an excellent choice for Battle Bots&rsquo; long-term growth.</p><h2 id=references>References</h2><ul><li><a href=https://openfga.dev/docs>OpenFGA Official Documentation</a></li><li><a href=https://github.com/openfga/openfga>OpenFGA GitHub Repository</a></li><li><a href=https://openfga.dev/docs/configuration-language>OpenFGA Configuration Language</a></li><li><a href=https://openfga.dev/docs/getting-started/setup-openfga/kubernetes>OpenFGA Kubernetes Setup</a></li><li><a href=https://openfga.dev/docs/getting-started/setup-openfga/docker>OpenFGA Docker Setup</a></li><li><a href=https://openfga.dev/docs/interacting/contextual-tuples>OpenFGA Contextual Tuples</a></li><li><a href=https://openfga.dev/docs/getting-started/framework>OpenFGA Framework Integration</a></li><li><a href=https://openfga.dev/docs/modeling/getting-started>OpenFGA Modeling Guide</a></li><li><a href=https://artifacthub.io/packages/helm/openfga/openfga>OpenFGA Helm Chart</a></li><li><a href=https://github.com/ZEISS/openfga-operator>ZEISS OpenFGA Operator</a></li><li><a href=https://github.com/canonical/openfga-operator>Canonical OpenFGA Operator</a></li><li><a href=https://research.google/pubs/pub48190/>Google Zanzibar Paper</a></li><li><a href=https://auth0.com/blog/tags/fga/>Auth0 FGA Blog Posts</a></li><li><a href=https://github.com/openfga/cli>OpenFGA CLI</a></li><li><a href=https://github.com/openfga/language>OpenFGA Language Grammar</a></li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="GitHub Discussions" aria-label="GitHub Discussions"><a target=_blank rel=noopener href=https://github.com/z5labs/battlebots/discussions aria-label="GitHub Discussions"><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/z5labs/battlebots aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2025
<span class=td-footer__authors>Z5Labs and Contributors</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span></div></div></div></footer></div><script src=/battlebots/pr-preview/pr-139/js/main.min.403ff095218c662472dab60ed98ecbb19431682de5ac7c6159891241cd366af5.js integrity="sha256-QD/wlSGMZiRy2rYO2Y7LsZQxaC3lrHxhWYkSQc02avU=" crossorigin=anonymous></script><script defer src=/battlebots/pr-preview/pr-139/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/battlebots/pr-preview/pr-139/js/tabpane-persist.js></script></body></html>